<!DOCTYPE html>
<html>
<head>
  <title>Home Rental Contract</title>
  <style>
    body {
      font-family: sans-serif;
    }

    h1 {
      text-align: center;
      font-size: 2em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid black;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>Home Rental Contract</h1>

  <table>
    <thead>
      <tr>
        <th>Listing ID</th>
        <th>Owner</th>
        <th>Description</th>
        <th>Price</th>
        <th>Deposit</th>
        <th>Available From</th>
        <th>Available To</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="listings"></tbody>
  </table>

  <script>
    // Get the list of listings from the Solidity contract
    async function getListings() {
      const contract = new web3.eth.Contract([CONTRACT_ABI], CONTRACT_ADDRESS);
      const listings = await contract.methods.listings().call();

      // Display the listings in the table
      const listingsTable = document.querySelector('#listings');
      listingsTable.innerHTML = '';

      for (const listing of listings) {
        const row = document.createElement('tr');

        const listingIdCell = document.createElement('td');
        listingIdCell.textContent = listing[0];
        row.appendChild(listingIdCell);

        const ownerCell = document.createElement('td');
        ownerCell.textContent = listing[1];
        row.appendChild(ownerCell);

        const descriptionCell = document.createElement('td');
        descriptionCell.textContent = listing[2];
        row.appendChild(descriptionCell);

        const priceCell = document.createElement('td');
        priceCell.textContent = listing[3];
        row.appendChild(priceCell);

        const depositCell = document.createElement('td');
        depositCell.textContent = listing[4];
        row.appendChild(depositCell);

        const availableFromCell = document.createElement('td');
        availableFromCell.textContent = listing[5];
        row.appendChild(availableFromCell);

        const availableToCell = document.createElement('td');
        availableToCell.textContent = listing[6];
        row.appendChild(availableToCell);

        const statusCell = document.createElement('td');
        statusCell.textContent = listing[7];
        row.appendChild(statusCell);

        const actionCell = document.createElement('td');
        actionCell.innerHTML = '<button onclick="rentListing(' + listing[0] + ')">Rent</button>';
        row.appendChild(actionCell);

        listingsTable.appendChild(row);
      }
    }

    // Rent a listing
    async function rentListing(listingId) {
      const contract = new web3.eth.Contract([CONTRACT_ABI], CONTRACT_ADDRESS);

      // Get the listing information
      const listing = await contract.methods.listings(listingId).call();

      // Calculate the rental price
      const rentalPrice = listing[3] + listing[4];

      // Send the rental payment to the contract
      await contract.methods.createRentalDeal(listingId, new Date().getTime() + 24 * 60 * 60 * 1000, new Date().getTime() + 48 * 60 * 60 * 1000).send({ from: web3.eth.defaultAccount, value: rentalPrice });

      // Update the listing status
      listing.status = 'Accepted';
      await contract.methods.listings(listingId).update(listing);

      // Update the listings table
      getListings();
    }

    // Load the listings when the page loads
    window.addEventListener('load', getListings);
  </script>
</body>
</html>